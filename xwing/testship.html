<!DOCTYPE html>
<html>
<head>
	<script src="https://code.jquery.com/jquery-2.2.2.min.js" integrity="sha256-36cp2Co+/62rEAAYHLmRCPIych47CvdM+uTBJwSzWjI=" crossorigin="anonymous"></script>
	<link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1q8mTJOASx8j1Au+a5WDVnPi2lkFfwwEAa8hDDdjZlpLegxhjVME1fgjWPGmkzs7" crossorigin="anonymous">
	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js" integrity="sha384-0mSbJDEHialfmuBBQP6A4Qrprq5OVfW37PRR3j5ELqxss1yVqOtnepnHVP9aJ7xS" crossorigin="anonymous"></script>
	<link href='https://fonts.googleapis.com/css?family=Orbitron:400,700' rel='stylesheet' type='text/css'>
	<link href='/xwing/res/css/ship.css' rel='stylesheet' type='text/css'>
</head>
<body style="padding: 15px;">
	<div class="ship ship-small">
		<div class="shipicon">x</div>
		<div class="action">f<br>l</div>
		<div class="statblock">
			<span class="stats ps">4 </span>
			<span class="stats attack">2 </span>
			<span class="stats evade">3 </span>
			<span class="stats hull">3 </span>
			<span class="stats shield">2</span>
		</div>
	</div>
	<div class="ship ship-large">
		<div class="shipicon">f</div>
		<div class="action">f<br>l<br>e</div>
		<div class="statblock">
			<span class="stats ps">4 </span>
			<span class="stats attack">2 </span>
			<span class="stats evade">3 </span>
			<span class="stats hull">3 </span>
			<span class="stats shield">2</span>
		</div>
	</div>
	
	<br />

	<canvas id="playmat" width="1000" height="1000" style="border: 1px solid grey;"></canvas>
	
	
</body>
<script>
	/* draw ships as above, then move and rotate */
	$(document).ready( function() {
		var c = document.getElementById('playmat');
		var ctx = c.getContext('2d');
		$("#playmat").on("click",function (e) {
			var ships = [
				{"size":"small","stats":[4,2,3,3,2],"acts":['f','l'], "symbol":"x","arc":["forward"],"faction":"rebel"},
				{"size":"large","stats":[4,2,3,3,2],"acts":['f','l','e'], "symbol":"f","arc":["forward","rear"],"faction":"imperial"},
				{"size":"large","stats":[4,2,3,3,2],"acts":['f','l','e'], "symbol":"m","arc":["turret"],"faction":"rebel"}
			];
			drawShip(ships[e.pageX<500?0:2],e.pageX-c.offsetLeft,e.pageY-c.offsetTop,Math.random()*360);
		});
		
		function drawShip(ship,x,y,r)	{
		/* Initialise Variables */
			var size = ship.size == 'large'?160:80;
			var stats = ship.stats;
			var acts = ship.acts;
			var symbol = ship.symbol;
		/* Set the relative location */
			ctx.translate (x, y);
			ctx.rotate(r*Math.PI/180);
		
		// Background
			ctx.fillStyle = 'black';
			ctx.fillRect(0,0,size,size);
		// Shooting Arc
			switch (ship.faction) {
				case ("rebel"):
					ctx.strokeStyle = "#FF0000";
					ctx.fillStyle = "rgba(255,0,0,0.2)";
					break;
				case ("imperial"):
					ctx.strokeStyle = "#00FF00";
					ctx.fillStyle = "rgba(0,255,0,0.2)";
					break;
				case ("scum"):
					ctx.strokeStyle = "#FF7700";
					ctx.fillStyle = "rgba(255,128,0,0.2)";
					break;
				default:
					ctx.strokeStyle = "#00FF00";
					ctx.fillStyle = "rgba(255,0,0,0.2)";
				}
			var arcOS = ship.size == "large" ? 4 : 2;
			//base arc for all ships
			ctx.beginPath();
			ctx.moveTo (arcOS,0);
			ctx.lineTo (size/2,size/2);
			ctx.lineTo (size-arcOS,0);
			ctx.stroke();
			ctx.fill();
			$.each(ship.arc, function(i,arc) {
				/*if (arc == "forward")	{		
					ctx.beginPath();			
					ctx.moveTo (arcOS,0);
					ctx.lineTo (size/2,size/2);
					ctx.lineTo (size-arcOS,0
				}*/
				if (arc=="rear")	{		
					ctx.beginPath();	
					ctx.moveTo (arcOS,size);
					ctx.lineTo (size/2,size/2);
					ctx.lineTo (size-arcOS,size);
					ctx.stroke();
					ctx.fill();
				}
				if(arc=="turret")	{
					ctx.beginPath();
					var inr = 30;
					var outr = 36;
					var arr=8;
					ctx.arc(size/2,size/2,outr,0,30*Math.PI/180,true);
					ctx.arc(size/2,size/2,inr,30*Math.PI/180,0,false);
					ctx.lineTo(size/2 + inr-arr,size/2);
					ctx.lineTo(size/2 + inr + (outr-inr)/2,size/2+(outr-inr+arr+arr)/2);
					ctx.lineTo(size/2 + outr+arr,size/2);
					ctx.lineTo(size/2 + outr,size/2);
					ctx.stroke();
					ctx.fill();
				}
			});
			
		// Stats
			ctx.font = "14px Orbitron";
			ctx.textAlign = "left";
			ctx.textBaseline = "alphabetic";
			var statTxt = "";
			$.each(stats,function(i,stat) {
				statTxt += stat;
				if (i<stats.length-1) {statTxt += ' ';}
			});
			var statW = ctx.measureText(statTxt).width;
			var statL = (size - statW)/2;
			var clr = ["#FF7700","#FF0000","#00FF00","#FFFF00","#00AAFF"];
			$.each(stats, function(i,stat) {
				ctx.fillStyle = clr[i];
				ctx.fillText(stat,statL,size-3);
				statL += ctx.measureText(stat + ' ').width;
			})
			
			ctx.font = "14px x-wing-symbols";
			ctx.fillStyle = "#00BB00";
			var actW = 0;
			var actH = 14;
			
			$.each(acts, function(i,act) {
				actW = Math.max(actW,ctx.measureText(act).width);
			});
			ctx.textAlign="center";
			var actL = size - (actW/2);
			var actT = actH-2;
			$.each(acts, function(i,act) {
				ctx.fillText(act,actL,actT);
				actT += actH;			
			});
			
			ctx.font = size + "px x-wing-ships";
			ctx.fillStyle = "rgba(255,255,255,0.8)";
			ctx.textAlign = "center";
			ctx.textBaseline = "middle";
			ctx.fillText(symbol,size/2,size/2);
			
			
			ctx.setTransform(1,0,0,1,0,0);
		}
	});
</script>
</html>