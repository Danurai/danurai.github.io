<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<title>String Parser</title>
	
	<!-- BOOTSTRAP -->
	<!-- Latest compiled and minified CSS -->
	<link rel="stylesheet" href="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css">

	<!-- jQuery library -->
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.0/jquery.min.js"></script>

	<!-- Latest compiled JavaScript -->
	<script src="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js"></script>
	
	 <!-- TAFFY DB -->
	<script src="https://cdnjs.cloudflare.com/ajax/libs/taffydb/2.7.2/taffy.js"></script>
	
	<!-- jquery QTIPs -->
	<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/qtip2/2.1.1/jquery.qtip.css">
	<script src="http://cdnjs.cloudflare.com/ajax/libs/qtip2/2.1.1/jquery.qtip.js"></script>
	
	<!-- saved scripts -->
	<script src="js/medb.cardfilter.js?6.3.15"></script>
	
	<script>
<!-- Regex Testing -->
		$( document ).ready( function()	{
			$("#tsttxt").keyup( function() {
				tstparse();
			});
			$("#tstregex").keyup( function() {
				tstparse();
			});
			function tstparse()	{
				var txt = $("#tsttxt").val();
				var reg = new RegExp($("#tstregex").val());
				var outp = '';
				
				if ( txt.match(reg) )	{								
					outp += "<p>$1: " + RegExp.$1;
					outp += "<p>$2: " + RegExp.$2;
					outp += "<p>$3: " + RegExp.$3;	
				}
				$("#tstresult").html(outp);
			};
			$("#qrytxt").keyup( function () {
				MEDB.cardfilter.setFilter($(this).val());
				//filter = setFilter($(this).val());
				var JSONfilter = JSON.stringify(MEDB.cardfilter.getFilter());
				$("#qryresult").html (JSONfilter);
		//Example = {deckcode:"p",typecode:["he","ev"],spherecode:"lo"};
			});

			
<!-- Deckbuilder Code -->			
		// Load core set
			var cardset;
			$.get("data/medb_test_data.txt", function(data, status) {
				console.log(status);
				cardset = TAFFY(data);

				var tbody = $("#cardtable");
				tbody.empty();
				
				cardset().each( function(record) {
					row = buildrow(record);
					tbody.append(row);
				});
			});
			
			var deckcards = TAFFY();	<!--e.g. [{code:"01001",qty:1},{code:"01002",qty:2}]-->
						
			function buildrow(record)	{
				var outp = '<tr name="'+record.code+'">';
				outp += '<td>';
				outp += '<div class="btn-group" data-toggle="buttons">';
				for (x=0; x< (record.typecode=="he"?2:4); x++)	{
					outp += '<label class="btn btn-xs btn-default';
					outp += x==0 ? ' active' : '';
					outp += '">';
					outp += '<input type="radio" name="qty-'+record.code+'" value="' + x + '">' + x;
					outp += '</label>';
				}
				outp += '</div>';
				outp += '</td>';
				outp += '<td><a href="#" name="'+record.code+'">'+record.cardname+'</a></td>';
				outp += '</tr>';
				return outp;
			}
			
			$("body").on("mouseenter","a", function() {
				var card=cardset({code:this.name}).first();
				imghtml = '<div '
					+'class="img-cardqtip pull-right" title="' + card.cardname + '" '
					+'style="background-image:url(' + card.cardart + ')">'
					+'</div>'
				$(this).qtip({
					overwrite: false,
					show: {
						ready: true
					},
					content: {
						text: '<h4>' 
							+ (card.unique ? '&diams;&nbsp;' : '')
							+ imghtml
							+ card.cardname + '</h4>'
							+ (card.traits != '' ? '<p class="text-center"><b><em>' + card.traits + '</em></b>': '')
							+ (card.abilities != '' ? '<p>' + card.abilities : '')
							+ '<p>' + card.cardtext
					},
					style: {
						classes: 'qtip-bootstrap'
					}
				});
			});
			
			//$("input[type=radio]").on("change", function (){
			$("#cardtable").on("change","input[type=radio]",function (){
				var outp;
				
				if ($(this).prop("checked")) {
					var cardcode = this.name.match(/[0-9]{5}/)[0];
					var cardqty = parseInt(this.value, 10);;
					var outp = "Card: " + cardcode + " x " + this.value;
					
					//$deckcards.merge({key:"code","code":this.name.match(/[0-9]{5}/),"qty":this.value},true);
					
					if (cardqty == 0)	{
						deckcards({"code":cardcode}).remove();
					}
					else {
						deckcards.merge({code:cardcode,qty:cardqty},"code",false);
					}
					
					writeCards();
				}
			});
			
			$("#checkvals").click( function()	{
				writeCards();
			});
			
			function writeCards()	{
				var hOut = aOut = atOut = evOut = oOut = '';
				var cData;
				var outp = '';
				deckcards().order("code").each( function(record) {
					cData = cardset({code:record.code}).first();
					outp += '<div>' + record.qty + ' x <a href="#" name="'+record.code+'">' + cData.cardname + '</a></div>';
					//outp += "<div>" + record["code"] + " x " + record["qty"] + "</div>";
				});
				
				
				outp += "<div>" + deckcards().stringify() + "</div>";
				$("#buildresults").html (outp);
			}
			
		});
	</script>
	<style>
		.img-cardqtip {
			width:80px; 
			height:80px; 
			border-radius: 40px;
			background-size: 120px; 
			background-repeat: no-repeat; 
			background-position: -32px 0px;
		}
		.qtip {
			max-width: 400px;
		}
	</style>
</head>
<body>
	<div class="container">
		<div class="row" style="padding-bottom: 20px">
			<div class="img-cardqtip" style="background-image:url(http://www.cardgamedb.com/forums/uploads/lotr/aragorn-core.jpg)"></div>
		</div>
		<div class="row" style="padding-bottom: 20px;">
			<h4>Deckbuild Testing</h4>
			<div class="col-sm-6" id="collection">
				<table class="table table-condensed">
					<thead>
						<tr>
							<th>Qty</th>
							<th>Card</th>
						</tr>
					</thead>
					<tbody id="cardtable">
					</tbody>							
				</table>
				<button class="btn btn-default pull-right disabled" id="checkvals">Check</button>
			</div>
			<div class="col-sm-6" id="deck_results">
				<b>Results</b>
				<div class="row" id="buildresults"></div>
			</div>
		</div>
		<div class="row">
			<h4>Regex Testing</h4>
			<div class="col-sm-6" id="parse_results">
				<h4>Parse Results</h4>
				<label>Find:</label><input type="text" class="form-control" id="qrytxt"></input>
				<br><label id="qryresult"></label>
			</div>
			<div class="col-sm-6" id="test-regex">
				<div class="Row">
				<h4>Quick Check</h4>
				<label>Text:</label><input type="text" class="form-control" id="tsttxt"></input>
				<label>REGEX:</label><input type="text" class="form-control" id="tstregex" value="(.*)"></input>
				<label>Results:</label>
				<br><label id="tstresult"></label>
				</div>
			</div>
		</div>
	</div>
</body>
