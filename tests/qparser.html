<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<title>String Parser</title>
	
	<!-- BOOTSTRAP -->
	<!-- Latest compiled and minified CSS -->
	<link rel="stylesheet" href="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css">

	<!-- jQuery library -->
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.0/jquery.min.js"></script>

	<!-- Latest compiled JavaScript -->
	<script src="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js"></script>
	
	 <!-- TAFFY DB -->
	<script src="https://cdnjs.cloudflare.com/ajax/libs/taffydb/2.7.2/taffy.js"></script>
	
	<!-- jquery QTIPs -->
	<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/qtip2/2.1.1/jquery.qtip.css">
	<script src="http://cdnjs.cloudflare.com/ajax/libs/qtip2/2.1.1/jquery.qtip.js"></script>
	
	<!-- saved scripts -->
	<script src="js/medb.cardfilter.js?6.3.15"></script>
	
	<script>
<!-- Regex Testing -->
		$( document ).ready( function()	{
			$("#tsttxt").keyup( function() {
				tstparse();
			});
			$("#tstregex").keyup( function() {
				tstparse();
			});
			function tstparse()	{
				var txt = $("#tsttxt").val();
				var reg = new RegExp($("#tstregex").val());
				var outp = '';
				
				if ( txt.match(reg) )	{								
					outp += "<p>$1: " + RegExp.$1;
					outp += "<p>$2: " + RegExp.$2;
					outp += "<p>$3: " + RegExp.$3;	
				}
				$("#tstresult").html(outp);
			};
			$("#qrytxt").keyup( function () {
				MEDB.cardfilter.setFilter($(this).val());
				//filter = setFilter($(this).val());
				var JSONfilter = JSON.stringify(MEDB.cardfilter.getFilter());
				$("#qryresult").html (JSONfilter);
		//Example = {deckcode:"p",typecode:["he","ev"],spherecode:"lo"};
			});

			
<!-- Deckbuilder Code -->			
		// Load core set
			var cardset;
			$.get("data/medb_test_data.txt", function(data, status) {
				console.log(status);
				cardset = TAFFY(data);

				var tbody = $("#cardtable");
				tbody.empty();
				
				cardset().each( function(record) {
					row = buildrow(record);
					tbody.append(row);
				});
			});
			
			var deckcards = TAFFY();	<!--e.g. [{code:"01001",qty:1},{code:"01002",qty:2}]-->
						
			function buildrow(record)	{
				var outp = '<tr name="'+record.code+'">';
				outp += '<td>';
				outp += '<div class="btn-group" data-toggle="buttons">';
				for (x=0; x< (record.typecode=="he"?2:4); x++)	{
					outp += '<label class="btn btn-xs btn-default';
					outp += x==0 ? ' active' : '';
					outp += '">';
					outp += '<input type="radio" name="qty-'+record.code+'" value="' + x + '">' + x;
					outp += '</label>';
				}
				outp += '</div>';
				outp += '</td>';
				outp += '<td><a href="#" name="'+record.code+'">'+record.cardname+'</a></td>';
				outp += '</tr>';
				return outp;
			}
			
			$("#deckbuild").on("mouseenter","a", function() {
				var card=cardset({code:this.name}).first();
				imghtml = '<div '
					+'class="img-cardqtip pull-right" title="' + card.cardname + '" '
					+'style="'
					+'background-image:url(' + card.cardart + '); '
					+'background-position:' + (card.typecode == 'at' ? '-20px -20px;' : '-32px 0px;') + '"'
					+'>'
					+'</div>';
				$(this).qtip({
					overwrite: false,
					show: {
						ready: true
					},
					content: {
						text: '<h4>' 
							+ (card.unique=="true" ? '&diams;&nbsp;' : '') + card.cardname
							+ imghtml
							+ '</h4>'
							+ (card.traits != '' ? '<p class="text-center"><b><em>' + card.traits + '</em></b>': '')
							+ (card.abilities != '' ? '<p>' + card.abilities : '')
							+ '<p>' + card.cardtext
							+ '<p><em>' + card.spherename + ' ' + card.typename + '</em>'
							+ '<div class="pull-right">' + card.setname + " #" + card.number + '</div>'
					},
					style: {
						classes: 'qtip-bootstrap',
						tip:	false
					},
					/*hide:	{
						event: 'unfocus'
					}*/
				});
			});
			
			$("#cardtable").on("change","input[type=radio]",function (){
				var outp;
				
				if ($(this).prop("checked")) {
					var cardcode = this.name.match(/[0-9]{5}/)[0];
					var cardqty = parseInt(this.value, 10);;
					var outp = "Card: " + cardcode + " x " + this.value;
					
					if (cardqty == 0)	{
						deckcards({"code":cardcode}).remove();
					}
					else {
						deckcards.merge({code:cardcode,qty:cardqty},"code",false);
					}
					
					writeCards();
				}
			});
			
			$("#checkvals").click( function()	{
				writeCards();
			});
			
			function writeCards()	{
				var hOut = aOut = atOut = evOut = oOut = '';
				var cData;
				var outp = '';
				deckcards().order("code").each( function(record) {
					cData = cardset({code:record.code}).first();
					outp += '<div>' + record.qty + ' x <a href="#" name="'+record.code+'">' + cData.cardname + '</a></div>';
					//outp += "<div>" + record["code"] + " x " + record["qty"] + "</div>";
				});
				
				
				outp += "<div>" + deckcards().stringify() + "</div>";
				$("#buildresults").html (outp);
			}
			
		});
	</script>
	<style>
		.img-cardqtip {
			width:80px; 
			height:80px; 
			border-radius: 40px;
			background-size: 120px; 
			background-repeat: no-repeat; 
		}
		.qtip {
			max-width: 350px;
		}
		.icon {
			margin-bottom:-0.1em;
			text-indent:0.4em;
			width: 15px; 
			height: 15px; 
			background-size: 15px;
			background-repeat: no-repeat;
			display: inline-block;
		}
		.icon-atk {
			background-image:url(data:image/png;base64,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);
		}
	</style>
<!---->
</head>
<body>
	<div class="container" style="margin-top: 10px;">
	
		<div class="panel-group" id="accordion">
			<div class="panel panel-default">
				<div class="panel-heading">
					<h4 class="panel-title">
						<a data-toggle="collapse" data-parent="#accordion" href="#iconreplace">Icon Replace</a>
					</h4>
				</div>
				<div id="iconreplace" class="panel-collapse collapse in">
					<div class="panel-body">
						<div class="form-group">
							<label>Replace [ATK] [DEF] [SPI] and Markup language (#Gimli)</label>
							<textarea rows="5" class="form-control" id="icontxt"></textarea>
						</div>
						Some text 5 <span class="icon icon-atk"></span> some more dfaklsdfgl
						<div id="iconresults"></div>
					</div>
				</div>
			</div>
			<div class="panel panel-default">
				<div class="panel-heading">
					<h4 class="panel-title">
						<a data-toggle="collapse" data-parent="#accordion" href="#deckbuild">Deckbuild Testing</a>
					</h4>
				</div>
				<div id="deckbuild" class="panel-collapse collapse">
					<div class="panel-body">
						<div class="col-md-12">
							<div class="col-md-6" id="collection">
								<table class="table table-condensed">
									<thead>
										<tr>
											<th>Qty</th>
											<th>Card</th>
										</tr>
									</thead>
									<tbody id="cardtable">
									</tbody>							
								</table>
								<button class="btn btn-default pull-right disabled" id="checkvals">Check</button>
							</div>
							<div class="col-md-6" id="deck_results">
								<b>Results</b>
								<div class="row" id="buildresults"></div>
							</div>
						</div>
					</div>
				</div>
			</div>
			<div class="panel panel-default">
				<div class="panel-heading">
					<h4 class="panel-title">
						<a data-toggle="collapse" data-parent="#accordion" href="#regextest">Regex Testing</a>
					</h4>
				</div>
				<div id="regextest" class="panel-collapse collapse">
					<div class="panel-body">
						<div class="col-sm-12">
							<div class="col-sm-6" id="parse_results">
								<h4>Parse Results</h4>
								<label>Find:</label><input type="text" class="form-control" id="qrytxt"></input>
								<br><label id="qryresult"></label>
							</div>
							<div class="col-sm-6" id="test-regex">
								<div class="Row">
								<h4>Quick Check</h4>
								<label>Text:</label><input type="text" class="form-control" id="tsttxt"></input>
								<label>REGEX:</label><input type="text" class="form-control" id="tstregex" value="(.*)"></input>
								<label>Results:</label>
								<br><label id="tstresult"></label>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
		
	</div>
</body>
