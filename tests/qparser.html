<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<title>String Parser</title>
	
	<!-- BOOTSTRAP -->
	<!-- Latest compiled and minified CSS -->
	<link rel="stylesheet" href="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css">

	<!-- jQuery library -->
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.0/jquery.min.js"></script>

	<!-- Latest compiled JavaScript -->
	<script src="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js"></script>
	
	 <!-- TAFFY DB -->
	<script src="https://cdnjs.cloudflare.com/ajax/libs/taffydb/2.7.2/taffy.js"></script>
	
	<!-- jquery QTIPs -->
	<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/qtip2/2.1.1/jquery.qtip.css">
	<script src="http://cdnjs.cloudflare.com/ajax/libs/qtip2/2.1.1/jquery.qtip.js"></script>
	
	<!-- saved scripts -->
	<script src="js/medb.cardfilter.js?6.3.15"></script>
	
	<script>
<!-- Regex Testing -->
		$( document ).ready( function()	{
			$("#tsttxt").keyup( function() {
				tstparse();
			});
			$("#tstregex").keyup( function() {
				tstparse();
			});
			function tstparse()	{
				var txt = $("#tsttxt").val();
				var reg = new RegExp($("#tstregex").val());
				var outp = '';
				
				if ( txt.match(reg) )	{								
					outp += "<p>$1: " + RegExp.$1;
					outp += "<p>$2: " + RegExp.$2;
					outp += "<p>$3: " + RegExp.$3;	
				}
				$("#tstresult").html(outp);
			};
			$("#qrytxt").keyup( function () {
				MEDB.cardfilter.setFilter($(this).val());
				//filter = setFilter($(this).val());
				var JSONfilter = JSON.stringify(MEDB.cardfilter.getFilter());
				$("#qryresult").html (JSONfilter);
		//Example = {deckcode:"p",typecode:["he","ev"],spherecode:"lo"};
			});

			
<!-- Deckbuilder Code -->			
		// Load core set
			var cardset;
			$.get("data/medb_test_data.txt", function(data, status) {
				console.log(status);
				cardset = TAFFY(data);

				var tbody = $("#cardtable");
				tbody.empty();
				
				cardset().each( function(record) {
					row = buildrow(record);
					tbody.append(row);
				});
			});
			
			var deckcards = TAFFY();	<!--e.g. [{code:"01001",qty:1},{code:"01002",qty:2}]-->
						
			function buildrow(record)	{
				var outp = '<tr name="'+record.code+'">';
				outp += '<td>';
				outp += '<div class="btn-group" data-toggle="buttons">';
				for (x=0; x<4; x++)	{
					outp += '<label class="btn btn-xs btn-default';
					outp += x==0 ? ' active' : '';
					outp += '">';
					outp += '<input type="radio" name="qty-'+record.code+'" value="' + x + '">' + x;
					outp += '</label>';
				}
				outp += '</div>';
				outp += '</td>';
				outp += '<td>'+record.code+'</td>';
				outp += '<td><a name="'+record.code+'">'+record.cardname+'</a></td>';
				outp += '</tr>';
				return outp;
			}
			
			$("#cardtable").on("mouseenter","a", function() {
				$(this).qtip({
					overwrite: false,
					show: {
						ready: true
					},
					content: {
						text: this.name
					},
					style: 'qtip-bootstrap'
				});
			});
			/*
			$("a").qtip({
				content: {
					text: $(this).name
				},
				style: 'qtip-bootstrap'
			});
			*/
			
			//$("input[type=radio]").on("change", function (){
			$("#cardtable").on("change","input[type=radio]",function (){
				var outp;
				
				if ($(this).prop("checked")) {
					var cardcode = this.name.match(/[0-9]{5}/)[0];
					var cardqty = parseInt(this.value, 10);;
					var outp = "Card: " + cardcode + " x " + this.value;
					
					//$deckcards.merge({key:"code","code":this.name.match(/[0-9]{5}/),"qty":this.value},true);
					
					if (cardqty == 0)	{
						deckcards({"code":cardcode}).remove();
					}
					else {
						deckcards.merge({code:cardcode,qty:cardqty},"code",false);
					/*
						if (deckcards({code:cardcode}).sum("qty") == 0)	{
							deckcards.insert({code:cardcode,qty:this.value});
						} else {
							deckcards({code:cardcode}).update({qty:cardqty});
						}
					*/
					}
					
					writeCards();
				}
			});
			
			$("#checkvals").click( function()	{
				writeCards();
			});
			
			function writeCards()	{
				var outp = "<div>" + deckcards().stringify() + "</div>";
				deckcards().each( function(record) {
					outp += "<div>" + record["code"] + " x " + record["qty"] + "</div>";
				});
				$("#buildresults").html (outp);
			}
			
		});
	</script>
</head>
<body>
	<div class="container">
		<div class="row" style="padding-bottom: 20px;">
			<h4>Deckbuild Testing</h4>
			<div class="col-md-6" id="collection">
				<table class="table table-condensed">
					<thead>
						<tr></tr>
						<tr>code</tr>
						<tr>name</tr>
					</thead>
					<tbody id="cardtable">
						<tr id="01001">
							<td>
								<div class="btn-group" data-toggle="buttons">
									<label class="btn btn-xs btn-default active">
										<input type="radio" name="qty-01001" value="0">0
									</label>
									<label class="btn btn-xs btn-default">
										<input type="radio" name="qty-01001" value="1">1
									</label>
									<label class="btn btn-xs btn-default">
										<input type="radio" name="qty-01001" value="2">2
									</label>
									<label class="btn btn-xs btn-default">
										<input type="radio" name="qty-01001" value="3">3
									</label>
								</div>
							</td>
							<td>01001</td>
							<td><a>A Hero</a></td>
						</tr>
						<tr name="01002">
							<td>
								<div class="btn-group" data-toggle="buttons">
									<label class="btn btn-xs btn-default active">
										<input type="radio" name="qty-01002" value="0">0
									</label>
									<label class="btn btn-xs btn-default">
										<input type="radio" name="qty-01002" value="1">1
									</label>
									<label class="btn btn-xs btn-default">
										<input type="radio" name="qty-01002" value="2">2
									</label>
									<label class="btn btn-xs btn-default">
										<input type="radio" name="qty-01002" value="3">3
									</label>
								</div>
							</td>
							<td>01002</td>
							<td><a>Ancient Thing</a></td>
						</tr>
						<tr name="01003">
							<td>
								<div class="btn-group" data-toggle="buttons">
									<label class="btn btn-xs btn-default active">
										<input type="radio" name="qty-01003" value="0">0
									</label>
									<label class="btn btn-xs btn-default">
										<input type="radio" name="qty-01003" value="1">1
									</label>
									<label class="btn btn-xs btn-default">
										<input type="radio" name="qty-01003" value="2">2
									</label>
									<label class="btn btn-xs btn-default">
										<input type="radio" name="qty-01003" value="3">3
									</label>
								</div>
							</td>
							<td>01003</td>
							<td><a>BFF</a></td>
						</tr>
					<tbody>							
				</table>
				<button class="btn btn-default pull-right disabled" id="checkvals">Check</button>
			</div>
			<div class="col-md-6" id="deck_results">
				<b>Results</b>
				<div class="row" id="buildresults"></div>
			</div>
		</div>
		<div class="row">
			<h4>Regex Testing</h4>
			<div class="col-md-6" id="parse_results">
				<h4>Parse Results</h4>
				<label>Find:</label><input type="text" class="form-control" id="qrytxt"></input>
				<br><label id="qryresult"></label>
			</div>
			<div class="col-md-6" id="test-regex">
				<div class="Row">
				<h4>Quick Check</h4>
				<label>Text:</label><input type="text" class="form-control" id="tsttxt"></input>
				<label>REGEX:</label><input type="text" class="form-control" id="tstregex" value="(.*)"></input>
				<label>Results:</label>
				<br><label id="tstresult"></label>
				</div>
			</div>
		</div>
	</div>
</body>
